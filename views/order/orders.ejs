
<%- include('../includes/head.ejs') -%>
<%- include('../includes/navigation.ejs') -%>

<%- include('../includes/header.ejs') -%>
<%- include('../components/searchbartr.ejs') -%>
<a href="/orders/neworder" class="btn btn-danger ml-3" type="button" aria-label="Add New">Add New</a>
</div>
</div>
</div>
</div>
</div>
<style>
  .filter-box {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 10px;
  }
  .search-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
  }
</style>
<div class="container-fluid mt--6">
    <div class="row">
      <div class="col">
        <div class="filter-box">
          <h5 class="mb-3">Filter By</h5>
          <div class="row g-3">
              <!-- Customer ID -->
              <div class="col-md-3 position-relative">
                  <label class="form-label">Customer I.D</label>
                  <input type="text" class="form-control" placeholder="Search ID Here">
                  <span class="search-icon">&#128269;</span> <!-- Search icon -->
              </div>
  
              <!-- Salesman ID -->
              <div class="col-md-3">
                  <label class="form-label">Salesman ID</label>
                  <select class="form-control">
                      <option selected>Select a Salesman</option>
                      <option value="1">Salesman 1</option>
                      <option value="2">Salesman 2</option>
                      <option value="3">Salesman 3</option>
                  </select>
              </div>
  
              <!-- Truck ID -->
              <div class="col-md-3">
                  <label class="form-label">Truck ID</label>
                  <select class="form-control">
                      <option selected>Select a Truck</option>
                      <option value="101">Truck 101</option>
                      <option value="102">Truck 102</option>
                      <option value="103">Truck 103</option>
                  </select>
              </div>
  
              <!-- Mode of Payment -->
              <div class="col-md-3">
                  <label class="form-label">Mode of Payment</label>
                  <select class="form-control">
                      <option selected>Select a Mode of Payment</option>
                      <option value="Cash">Cash</option>
                      <option value="Credit">Credit</option>
                      <option value="Online">Online Transfer</option>
                  </select>
              </div>
  
              <!-- Order Status -->
              <div class="col-md-3">
                  <label class="form-label">Status</label>
                  <select class="form-control">
                      <option selected>Select Order status</option>
                      <option value="Pending">Pending</option>
                      <option value="Completed">Completed</option>
                      <option value="Cancelled">Cancelled</option>
                  </select>
              </div>
  
              <!-- From Date -->
              <div class="col-md-3">
                  <label class="form-label">From</label>
                  <input type="date" class="form-control">
              </div>
  
              <!-- To Date -->
              <div class="col-md-3">
                  <label class="form-label">To</label>
                  <input type="date" class="form-control">
              </div>
          </div>
      </div>
  
      </div>
      <div class="col">
        <div class="card">
          <!-- Card header -->
          <div class="card-header border-0">
            <h3 class="mb-0">Truck Delivery and Details</h3>
          </div>
          <!-- Light table -->
          <div class="table-responsive">
            <table id="ordertable" class="table align-items-center table-flush">
              <thead class="thead-light">
                <tr>
                  <th scope="col" class="sort" data-sort="name">Order ID</th>
                  <th scope="col" class="sort" data-sort="name">createdAt</th>
                  <th scope="col" class="sort" data-sort="budget">Customer Name</th>
                  <th scope="col" class="sort" data-sort="status">View Order</th>

                  <th scope="col" class="sort">Truck</th>
                  <th scope="col" class="sort" data-sort="completion">Delivery Date</th>
                  <!-- <th scope="col" class="sort">Time</th> -->
                  
                  <!-- <th scope="col" class="sort" data-sort="completion">Price 5-gal</th> -->
                  <th scope="col" class="sort" data-sort="completion">Total Price</th>
                  <th scope="col" class="sort" data-sort="completion">Credit Status</th>
                  <!-- <th scope="col" class="sort" data-sort="completion">Pay by</th> -->
                  <th scope="col" class="sort" data-sort="completion">Updated At</th>

                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody class="list">
                <tr>

                </tr>
              </tbody>
            </table>
          </div>
          <!-- Card footer -- -->
        </div>
      </div>
    </div>
    <div class="modal fade" id="salesZoneModal" tabindex="-1" aria-labelledby="salesZoneModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="salesZoneModalLabel">Truck Stock Details</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Order Quantity</th>
                  <th>Customer Price</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="salesZoneTableBody">
                <tr>
                  <td>Water Cup</td>
                  <td>1000 Cups</td>
                  <td>$0.10 per cup</td>
                  <td>$100</td>
                </tr>
                <tr>
                  <td>200 ml Bottle</td>
                  <td>500 Bottles</td>
                  <td>$0.50 per bottle</td>
                  <td>$250</td>
                </tr>
                <tr>
                  <td>5 Gallon Bottle</td>
                  <td>300 Bottles</td>
                  <td>$5.00 per bottle</td>
                  <td>$1500</td>
                </tr>
                <tr>
                  <td>Dispenser</td>
                  <td>50 Units</td>
                  <td>$20.00 per unit</td>
                  <td>$1000</td>
                </tr>
              </tbody>
            </table>
            
            
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap4.min.js"></script>

    <script>
      $(document).ready(function () {
        console.log('hehe')

        // Initialize DataTable
       var datatable = $('#ordertable').DataTable({
        responsive: true,
              processing: true,
              serverSide: true,
          ajax: {
            url: '/getorders', // Backend API endpoint
            dataSrc: 'docs', // Key that holds the array of data in the API response
                data: function (d) {
                  return d;

                  // Add any additional parameters you want to send to the server here
                },// Data source is the root of the response array
          },
          columns: [
         { data: 'id', title: 'Order ID' }, // Order ID
         {
            data: 'createdAt',
            title: 'Creation Date',
            render: function (data) {
              return new Date(data).toLocaleDateString(); // Format date
            }
          },
           { data: 'name', title: 'Customer Name' }, // Customer Name
           { 
    data: null, 
    orderable: false, // Prevent sorting on this column
    searchable: false, // Prevent search filter on buttons
    render: function(data, type, row) {
      return `
        <button class="btn btn-secondary viewsaleszone-zone" data-id="${row._id}">View Order</button>
      `;
    }
  },          // { data: 'noOf200mlBottles', title: 'No:of 200ml bottles' },
        { data: 'truckId', title: 'Truck' }, // Truck
        { data: 'status', title: 'Delivery Status' },
          //  {
          //   data: 'status',
          //   title: 'Delivery Status',
          //   render: function (data) {
          //     return new Date(data).toLocaleDateString(); // Format date
          //   }
          // },
          // {
          //   data: 'delivered_at',
          //   title: 'Time',
          //   render: function (data) {
          //     return new Date(data).toLocaleTimeString(); // Format time
          //   }
          // },
          
          // { data: 'priceFor5galBottles', title: 'Price 5-gal' }, // Price 5-gal
          { data: 'totalPrice', title: 'Total' }, // Price 200ml
         {
            data: 'isCreditCustomerPaid',
            title: 'Credit Status',
            render: function (data) {
              return data ? 'Paid' : 'Unpaid'; // Render credit status
            }
          },
          //  {
          //   data: 'modeOfPayment',
          //   title: 'Pay b',
          //   render: function (data) {
          //     return data || 'N/A'; // Display mode of payment or N/A
          //   }
          // },
          {
            data: 'updatedAt',
            title: 'Updated At',
            render: function (data) {
              return new Date(data).toLocaleString(); // Format date
            }
          },
        { data: null, render: function(data, type, row) {
            return `
              <button class="btn btn-primary edit-zone" data-id="${row._id}">Edit</button>
              <button class="btn btn-danger history-zone" data-id="${row._id}">View</button>
            `;
          }
        }
]
   });
   $('#ordertable tbody').on('click', '.edit-zone', function () {
        var orderId = $(this).data('id');
        window.location.href = '/editorder/' + orderId;
    });

    // Handle History button click
    $('#ordertable tbody').on('click', '.history-zone', function () {
        var orderId = $(this).data('id');
        window.location.href = '/orderhistory/' + orderId;
    });
      });
    </script>
<script>
  $(document).ready(function () {
    $(document).on("click", ".viewsaleszone-zone", function () {
      let salesZoneId = $(this).data("id"); // Get the ID from button

      // Fetch sales data using AJAX (assuming an API endpoint `/api/saleszone/:id`)
      // $.ajax({
      //   url: `/api/saleszone/${salesZoneId}`, // Modify this based on your API
      //   type: "GET",
      //   success: function (response) {
      //     let salesData = response.salesData; // Assuming API returns { salesData: [...] }

      //     // Clear the existing rows in the table
      //     $("#salesZoneTableBody").empty();

      //     // Populate the modal table with new data
      //     salesData.forEach(sale => {
      //       let available = sale.totalLoad - (sale.quantityDelivered + sale.quantityReturned + sale.damagedQuantity);

      //       $("#salesZoneTableBody").append(`
      //         <tr>
      //           <td>${sale.item}</td>
      //           <td>${sale.totalLoad}</td>
      //           <td>${sale.quantityDelivered}</td>
      //           <td>${sale.quantityReturned}</td>
      //           <td>${sale.damagedQuantity}</td>
      //           <td>${available}</td>
      //         </tr>
      //       `);
      //     });

      //     // Show the modal
      //     $("#salesZoneModal").modal("show");
      //   },
      //   error: function () {
      //     alert("Failed to fetch sales data.");
      //   }
      // });
      $("#salesZoneModal").modal("show");

    });
  });
</script>
<%- include('../includes/footer.ejs') -%>

<%- include('../includes/end.ejs') -%>