<%- include('../includes/head.ejs') -%>
<%- include('../includes/navigation.ejs') -%>

<%- include('../includes/header.ejs') -%>
<%- include('../components/searchbartr.ejs') -%>
<style>
  /* Modern dashboard styling */


  body {
    background-color: #f5f7fa;
    color: var(--text-dark);
  }

  .filter-box {
    background: #fff;
    padding: 24px;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    margin-bottom: 24px;
    border: 1px solid rgba(0, 0, 0, 0.05);
  }

  .filter-box h5 {
    color: var(--text-dark);
    font-weight: 600;
    font-size: 18px;
    margin-bottom: 20px;
    position: relative;
    padding-bottom: 10px;
  }

  .filter-box h5:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 50px;
    height: 3px;
    background-color: var(--primary-color);
    border-radius: 2px;
  }

  .form-control {
    border-radius: var(--border-radius);
    padding: 10px 15px;
    border: 1px solid #e0e0e0;
    transition: all 0.3s ease;
  }

  .form-control:focus {
    border-color: var(--primary-light);
    box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.15);
  }

  .form-label {
    font-weight: 500;
    color: var(--text-light);
    margin-bottom: 8px;
  }

  /* Tab navigation styling */
  .custom-nav-tabs {
    display: flex;
    gap: 10px;
    padding: 0;
    margin: 0 0 25px 0;
    list-style: none;
    flex-wrap: wrap;
  }

  .custom-nav-tabs .nav-link {
    text-align: center;
    padding: 12px 20px;
    color: var(--text-light);
    font-weight: 600;
    border: none;
    border-radius: var(--border-radius);
    background-color: white;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
  }

  .custom-nav-tabs {
    border-bottom: 0px;
  }

  .custom-nav-tabs .nav-link:hover {
    color: white;
    background-color: var(--primary-light);
    transform: translateY(-2px);
  }

  .custom-nav-tabs .nav-link.active {
    color: white;
    background-color: var(--primary-color);
    box-shadow: 0 4px 8px rgba(67, 97, 238, 0.2);
  }

  /* Card styling */
  .card {
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    border: none;
    overflow: hidden;
  }

  /* Tab buttons */
  .tab-button {
    padding: 12px 20px;
    border: none;
    cursor: pointer;
    background: white;
    font-weight: 600;
    margin-right: 10px;
    transition: 0.3s;
    border-radius: var(--border-radius);
    color: var(--text-light);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    text-decoration: none;
    display: inline-block;
  }

  .tab-button.active {
    background: var(--primary-color);
    color: white;
    box-shadow: 0 4px 8px rgba(67, 97, 238, 0.2);
    transform: translateY(-2px);
  }

  .tab-button:hover {
    background: var(--primary-light);
    color: white;
    transform: translateY(-2px);
  }

  /* Table styling */
  .table {
    margin-bottom: 0;
    color: var(--text-dark);
  }

  .table thead th {
    background-color: #f8f9fa;
    padding: 15px;
    font-weight: 600;
    border-bottom: 2px solid #eaeaea;
  }

  .table tbody td {
    padding: 15px;
    border-bottom: 1px solid #eaeaea;
    vertical-align: middle;
  }

  .table-responsive {
    padding: 20px;
  }

  /* Links in table */
  .salesman-link {
    color: var(--primary-color);
    font-weight: 500;
    text-decoration: none;
    transition: color 0.3s;
  }

  .salesman-link:hover {
    color: var(--secondary-color);
    text-decoration: underline;
  }

  /* Pagination styling */
  .dataTables_paginate .paginate_button {
    border: none !important;
    border-radius: var(--border-radius) !important;
    padding: 5px 10px !important;
  }

  .dataTables_paginate .paginate_button.current {
    background: var(--primary-color) !important;
    color: white !important;
    border: none !important;
  }

  /* Search box styling */
  .dataTables_filter input {
    border-radius: var(--border-radius);
    border: 1px solid #e0e0e0;
    padding: 8px 12px;
    margin-left: 8px;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .tab-button {
      margin-bottom: 10px;
      width: 100%;
      text-align: center;
    }
  }
</style>
<!-- <%- include('../components/datefilter.ejs') -%> -->
</div>
</div>
</div>
</div>
</div>
<div class="container-fluid mt--6">
    <div class="row">
      <div class="col-12 mb-2">
        <div class="filter-section">
          <h5 class="mb-4"><i class="fas fa-filter text-primary mr-2"></i>Filter By</h5>
          <div class="row">
            <!-- Salesman ID -->
            <div class="col-md-3 mb-3">
              <label class="form-label small font-weight-bold">Salesman ID</label>
              <select class="form-control">
                <option selected>Select a Salesman</option>
                <option value="1">Salesman 1</option>
                <option value="2">Salesman 2</option>
                <option value="3">Salesman 3</option>
              </select>
            </div>
      
            <!-- Salesman Name -->
            <div class="col-md-3 mb-3">
              <label class="form-label small font-weight-bold">Salesman Name</label>
              <select class="form-control">
                <option selected>Select a Salesman</option>
                <option value="1">Salesman 1</option>
                <option value="2">Salesman 2</option>
                <option value="3">Salesman 3</option>
              </select>
            </div>
      
            <!-- Zone -->
            <div class="col-md-3 mb-3">
              <label class="form-label small font-weight-bold">Zone</label>
              <select class="form-control">
                <option selected>Select a Truck</option>
                <option value="101">Truck 101</option>
                <option value="102">Truck 102</option>
                <option value="103">Truck 103</option>
              </select>
            </div>
      
            <!-- Customer Type -->
            <div class="col-md-3 mb-3">
              <label class="form-label small font-weight-bold">Customer Type</label>
              <select class="form-control">
                <option selected>Select a Mode of Payment</option>
                <option value="Cash">Cash</option>
                <option value="Credit">Credit</option>
                <option value="Online">Online Transfer</option>
              </select>
            </div>
      
            <!-- From Date -->
            <div class="col-md-3 mb-3">
              <label class="form-label small font-weight-bold">From Date</label>
              <div class="date-input-group">
                <input type="date" class="form-control">
              </div>
            </div>
      
            <!-- To Date -->
            <div class="col-md-3 mb-3">
              <label class="form-label small font-weight-bold">To Date</label>
              <div class="date-input-group">
                <input type="date" class="form-control">
              </div>
            </div>
      
            <!-- Action Buttons -->
            <div class="col-md-6 mb-3 d-flex align-items-end">
              <button class="btn filter-btn mr-2">
                <i class="fas fa-filter mr-1"></i> Apply
              </button>
              <button class="btn btn-outline-secondary">
                <i class="fas fa-sync-alt mr-1"></i> Reset
              </button>
            </div>
          </div>
        </div>
      </div>
      
  
      </div>
        
      <div class="col">
        <ul class="nav nav-tabs nav-tabs-custom" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="salesman-tab"  href="/report">
              <i class="fa-solid fa-users-gear mr-2"></i>Salesman Collection
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="salesman-tab"  href="/customerreport">
              <i class="ni ni-circle-08 mr-2"></i>Customer Report
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link " id="salesman-tab"  href="/creditreport">
              <i class="fa-solid fa-credit-card mr-2"></i>Credit Report
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="salesman-tab"  href="/truckreport">
              <i class="fa-solid fa-truck mr-2"></i>Truck Report
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="salesman-tab"  href="/commissionreport">
              <i class="fa-solid fa-money-bill-wave mr-2"></i>Commission Report
            </a>
          </li>
        </ul>
      </div>  

      <div class="col">
        <div class="card">
          <div class="card-header">
            <div class="row align-items-center">
              <div class="col">
                <h3 class="mb-0 text-white"><i class="fa-solid fa-users-gear mr-2"></i>Salesman Report</h3>
              </div>
              <div class="col text-right">
                <button class="btn btn-sm btn-light">
                  <i class="fas fa-file-export mr-1"></i> Export
                </button>
              </div>
            </div>
          </div>
      
          <div class="table-responsive">
            <table id="reporttable" class="table align-items-center table-flush">
              <thead class="thead-light">
                <tr>
                  <th scope="col" class="sort" data-sort="name">ID</th>
                  <th scope="col" class="sort" data-sort="budget">Name</th>
                  <th scope="col" class="sort" data-sort="status">Security Deposit</th>
                  <th scope="col" class="sort" data-sort="completion">Wallet Recharge</th>
                  <th scope="col" class="sort" data-sort="completion">Delivery Collection</th>
                  <th scope="col">Total Collection</th>
                </tr>
              </thead>
              <tbody class="list">
                <tr>
                  <!-- Data will be loaded dynamically -->
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Footer -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap4.min.js"></script>

<script>
  $(document).ready(function () {
  // Initialize DataTable
  const table = $('#reporttable').DataTable({
    ajax: {
      url: '/getsalesmanreport', // Endpoint to fetch data
      dataSrc: ''
    },
    columns: [
      { data: 'id' },
      { 
                data: 'name', 
                title: 'Salesman Name',
                render: function (data, type, row) {
                    return `<a href="individualsalesmanreport/${row.id}" class="salesman-link" data-id="${row.id}">${data}</a>`;
                }
            }, 
      { data: 'totalBottleDeposits' },
      { data: 'totalWalletCollection' },
      { data: 'totalCreditCollection' },
      { data: 'totalCollection' }
    ],
    "language": {
      "paginate": {
        "previous": "<i class='fas fa-chevron-left'></i>",
        "next": "<i class='fas fa-chevron-right'></i>"
      }
    },
  });

  // Handle form submission
  $('#dateForm').on('submit', function (e) {
    e.preventDefault();

    // Get selected dates
    const fromDate = $('#fromDate').val();
    const toDate = $('#toDate').val();
    const download = $('#download').val();

    // Reload DataTable with new parameters
    if(download =='Yes'){
      window.location.href = `/getsalesmanreportxl?fromDate=${fromDate}&toDate=${toDate}&download=${download}`;
    } else {
      table.ajax.url(`/getsalesmanreport?fromDate=${fromDate}&toDate=${toDate}&download=${download}`).load();
    }

    // Close the modal
    $('#dateModal').modal('hide');
  });
});
</script>
<%- include('../includes/footer.ejs') -%>

<%- include('../includes/end.ejs') -%>